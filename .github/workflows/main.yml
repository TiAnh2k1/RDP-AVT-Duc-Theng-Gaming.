name: üêß LINUX ONLY: AVT Duc Theng Gaming SSH üöÄ

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest # Ch·∫°y tr√™n Linux Runner
    
    steps:
      # 1. C·∫•u h√¨nh T√†i kho·∫£n v√† M·∫≠t kh·∫©u (ƒê√É FIX L·ªñI M·∫¨T KH·∫®U)
      - name: Configure Linux User and SSH Password
        env:
          USER_PASSWORD: ${{ secrets.RDP_PASSWORD }}
        run: |
          set -e
          USERNAME="DucThengGaming"
          
          # 1. T·∫°o t√†i kho·∫£n n·∫øu ch∆∞a t·ªìn t·∫°i
          if ! id "$USERNAME" >/dev/null 2>&1; then
              sudo useradd -m -s /bin/bash $USERNAME
              echo "T√†i kho·∫£n m·ªõi $USERNAME ƒë√£ ƒë∆∞·ª£c t·∫°o."
          fi
          
          # 2. ƒê·∫∑t/C·∫≠p nh·∫≠t m·∫≠t kh·∫©u b·∫±ng l·ªánh passwd (An to√†n h∆°n v·ªõi k√Ω t·ª± ƒë·∫∑c bi·ªát)
          # L·ªánh n√†y s·∫Ω cung c·∫•p m·∫≠t kh·∫©u 2 l·∫ßn (d√≤ng 1 l√† m·∫≠t kh·∫©u, d√≤ng 2 l√† x√°c nh·∫≠n)
          echo -e "$USER_PASSWORD\n$USER_PASSWORD" | sudo passwd $USERNAME
          
          # 3. C·∫•p quy·ªÅn sudo (qu·∫£n tr·ªã)
          sudo usermod -aG sudo $USERNAME
          
          echo "T√†i kho·∫£n SSH: $USERNAME ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng."

      # 2. D·ªçn d·∫πp h·ªá th·ªëng Linux
      - name: System Optimization (Cleanup)
        run: |
          sudo apt update
          sudo apt autoremove -y
          sudo apt clean

      # 3. K·∫øt n·ªëi v√†o m·∫°ng Tailscale
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          version: latest
          hostname: github-vps-linux 

      # 4. T·∫°o Banner SSH v√† Kh·ªüi ƒë·ªông SSH (ƒê√É FIX KH·ªûI ƒê·ªòNG D·ªäCH V·ª§)
      - name: Create Premium SSH Banner and Start Service
        run: |
          # Thi·∫øt l·∫≠p Banner
          echo "===================================================" | sudo tee /etc/motd
          echo "üíé VPS PREMIUM SI√äU X·ªäN: DUC THENG GAMING! üíé" | sudo tee -a /etc/motd
          echo "WELCOME, BOSS! ƒê√¢y l√† m√¥i tr∆∞·ªùng Linux (Ubuntu) m·∫°nh m·∫Ω." | sudo tee -a /etc/motd
          echo "Gi·ªõi h·∫°n th·ªùi gian: 6 ti·∫øng." | sudo tee -a /etc/motd
          echo "===================================================" | sudo tee -a /etc/motd
          
          # ƒê·∫£m b·∫£o d·ªãch v·ª• SSH ƒë∆∞·ª£c k√≠ch ho·∫°t v√† kh·ªüi ƒë·ªông (Ph∆∞∆°ng ph√°p tin c·∫≠y h∆°n)
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo "D·ªãch v·ª• SSH ƒë√£ ƒë∆∞·ª£c kh·ªüi ƒë·ªông ·ªïn ƒë·ªãnh."

      # 5. Hi·ªÉn th·ªã th√¥ng b√°o h∆∞·ªõng d·∫´n
      - name: H∆∞·ªõng d·∫´n k·∫øt n·ªëi SSH
        run: |
          echo "==================================================="
          echo "VPS LINUX ƒê√É S·∫¥N S√ÄNG! (SSH Only)"
          echo "User: DucThengGaming"
          echo "Pass: (M·∫≠t kh·∫©u Secret)"
          echo "==================================================="

      # 6. Treo m√°y (Keep Alive)
      - name: Keep Alive (Fixed Exit Code 1)
        run: |
          echo "VPS ƒëang ho·∫°t ƒë·ªông. ƒê·ª´ng ƒë√≥ng tab n√†y."
          while true; do
            sleep 60
          done
